<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>语言检测测试 - Language Detection Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            line-height: 1.6;
        }
        .test-section {
            background: #f5f5f5;
            padding: 1.5rem;
            margin: 1rem 0;
            border-radius: 8px;
            border-left: 4px solid #007acc;
        }
        .code {
            background: #2d3748;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
        }
        .button {
            background: #007acc;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 0.5rem;
        }
        .button:hover {
            background: #005a9e;
        }
    </style>
</head>
<body>
    <h1>🌐 博客自动语言切换功能测试</h1>
    
    <div class="test-section">
        <h2>✅ 功能已成功实现！</h2>
        <p><strong>自动语言检测和切换功能现在已经完全集成到你的博客中了。</strong></p>
    </div>

    <div class="test-section">
        <h2>🔧 工作原理</h2>
        <ol>
            <li><strong>浏览器语言检测</strong>：检测用户浏览器的首选语言设置</li>
            <li><strong>智能匹配</strong>：将浏览器语言映射到支持的语言（中文/英文）</li>
            <li><strong>首次访问重定向</strong>：仅在用户首次访问首页时自动重定向</li>
            <li><strong>用户偏好记忆</strong>：一旦用户手动选择语言，会保存偏好到 localStorage</li>
            <li><strong>尊重用户选择</strong>：不会覆盖用户的手动语言选择</li>
        </ol>
    </div>

    <div class="test-section">
        <h2>🧪 测试方法</h2>
        
        <h3>方法1: 清除浏览器数据测试</h3>
        <ol>
            <li>打开浏览器开发者工具 (F12)</li>
            <li>进入 Application/应用程序 标签</li>
            <li>在左侧找到 Local Storage</li>
            <li>删除 <code>preferred-language</code> 键</li>
            <li>刷新页面，观察是否根据浏览器语言自动重定向</li>
        </ol>

        <h3>方法2: 修改浏览器语言设置</h3>
        <ol>
            <li>Chrome: 设置 → 高级 → 语言</li>
            <li>Firefox: 设置 → 常规 → 语言</li>
            <li>Safari: 偏好设置 → 高级 → 语言</li>
            <li>将英文设为首选语言，然后访问博客首页</li>
            <li>将中文设为首选语言，然后清除数据再访问</li>
        </ol>

        <h3>方法3: 使用控制台测试</h3>
        <div class="code">
// 清除用户偏好
localStorage.removeItem('preferred-language');

// 检查当前浏览器语言
console.log('浏览器语言:', navigator.languages);

// 手动触发语言检测逻辑
console.log('当前页面语言:', window.location.pathname.startsWith('/en/') ? 'en' : 'zh_CN');
        </div>
    </div>

    <div class="test-section">
        <h2>📋 支持的语言映射</h2>
        <ul>
            <li><strong>中文</strong>: zh, zh-CN, zh-cn, zh-Hans, zh-hans → zh_CN</li>
            <li><strong>英文</strong>: en, en-US, en-us, en-GB, en-gb → en</li>
            <li><strong>默认</strong>: 其他所有语言 → zh_CN (中文)</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>🎯 测试场景</h2>
        
        <h3>✅ 应该自动重定向的情况：</h3>
        <ul>
            <li>首次访问博客首页 (<code>/</code>)</li>
            <li>没有保存的语言偏好</li>
            <li>浏览器语言与当前页面语言不匹配</li>
        </ul>

        <h3>❌ 不应该重定向的情况：</h3>
        <ul>
            <li>用户已手动选择过语言（localStorage 中有偏好）</li>
            <li>访问的不是首页（如 <code>/posts/xxx</code>）</li>
            <li>浏览器语言与当前页面语言已匹配</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>🚀 快速测试按钮</h2>
        <button class="button" onclick="clearPreference()">清除语言偏好</button>
        <button class="button" onclick="checkStatus()">检查当前状态</button>
        <button class="button" onclick="simulateEnglish()">模拟英文用户</button>
        <button class="button" onclick="simulateChinese()">模拟中文用户</button>
        
        <div id="status" style="margin-top: 1rem; padding: 1rem; background: #e7f3ff; border-radius: 4px;"></div>
    </div>

    <script>
        function clearPreference() {
            localStorage.removeItem('preferred-language');
            updateStatus('✅ 已清除语言偏好，下次访问首页将自动检测浏览器语言');
        }

        function checkStatus() {
            const preference = localStorage.getItem('preferred-language');
            const browserLangs = navigator.languages.join(', ');
            const currentLang = window.location.pathname.startsWith('/en/') ? 'English' : 'Chinese';
            
            updateStatus(`
                <strong>当前状态：</strong><br>
                📱 浏览器语言: ${browserLangs}<br>
                💾 保存的偏好: ${preference || '无'}<br>
                🌐 当前页面语言: ${currentLang}<br>
                🔄 下次访问首页会重定向: ${!preference ? '是' : '否'}
            `);
        }

        function simulateEnglish() {
            updateStatus('🔧 要模拟英文用户，请：<br>1. 点击"清除语言偏好"<br>2. 将浏览器语言设为英文<br>3. 访问博客首页');
        }

        function simulateChinese() {
            updateStatus('🔧 要模拟中文用户，请：<br>1. 点击"清除语言偏好"<br>2. 将浏览器语言设为中文<br>3. 访问博客首页');
        }

        function updateStatus(message) {
            document.getElementById('status').innerHTML = message;
        }

        // 页面加载时显示当前状态
        window.onload = checkStatus;
    </script>

    <div class="test-section">
        <h2>🎉 恭喜！</h2>
        <p>你的博客现在具备了智能的自动语言切换功能！访客会根据他们的浏览器语言偏好自动看到合适的语言版本。</p>
        <p><a href="/" style="color: #007acc;">← 返回博客首页测试</a></p>
    </div>
</body>
</html>
