---
import { getCollection } from "astro:content";
import SinglePost from "../../../components/SinglePost.astro";
import MainGridLayout from "../../../layouts/MainGridLayout.astro";

export async function getStaticPaths() {
	const posts = await getCollection("posts/en");
	
	// Sort posts by date
	const sorted = posts.sort((a, b) => {
		const dateA = new Date(a.data.published);
		const dateB = new Date(b.data.published);
		return dateA > dateB ? -1 : 1;
	});

	// Add prev/next links
	for (let i = 1; i < sorted.length; i++) {
		sorted[i].data.nextSlug = sorted[i - 1].slug;
		sorted[i].data.nextTitle = sorted[i - 1].data.title;
	}
	for (let i = 0; i < sorted.length - 1; i++) {
		sorted[i].data.prevSlug = sorted[i + 1].slug;
		sorted[i].data.prevTitle = sorted[i + 1].data.title;
	}
	
	return sorted.map((post) => ({
		params: { slug: post.slug },
		props: { entry: post },
	}));
}

const { entry } = Astro.props;
const { headings } = await entry.render();
---

<MainGridLayout 
	title={entry.data.title} 
	description={entry.data.description}
	lang="en"
	setOGTypeArticle={true}
	headings={headings}
>
	<SinglePost entry={entry} />
</MainGridLayout>
