---
import type { GetStaticPaths } from "astro";
import { getCollection } from "astro:content";
import Pagination from "../../components/control/Pagination.astro";
import PostPage from "../../components/PostPage.astro";
import { PAGE_SIZE } from "../../constants/constants";
import MainGridLayout from "../../layouts/MainGridLayout.astro";

export const getStaticPaths = (async ({ paginate }) => {
	// Get English posts from the new structure
	const posts = await getCollection("posts/en", ({ data }) => {
		return import.meta.env.PROD ? data.draft !== true : true;
	});
	
	const sorted = posts.sort((a, b) => {
		const dateA = new Date(a.data.published);
		const dateB = new Date(b.data.published);
		return dateA > dateB ? -1 : 1;
	});

	// Add prev/next links
	for (let i = 1; i < sorted.length; i++) {
		sorted[i].data.nextSlug = sorted[i - 1].slug;
		sorted[i].data.nextTitle = sorted[i - 1].data.title;
	}
	for (let i = 0; i < sorted.length - 1; i++) {
		sorted[i].data.prevSlug = sorted[i + 1].slug;
		sorted[i].data.prevTitle = sorted[i + 1].data.title;
	}

	return paginate(sorted, { pageSize: PAGE_SIZE });
}) satisfies GetStaticPaths;

const { page } = Astro.props;
const len = page.data.length;
---

<MainGridLayout title="Blog" lang="en">
    <PostPage page={page}></PostPage>
    <Pagination class="mx-auto onload-animation" page={page} style={`animation-delay: calc(var(--content-delay) + ${(len)*50}ms)`}></Pagination>
</MainGridLayout>
